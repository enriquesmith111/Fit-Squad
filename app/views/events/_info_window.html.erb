
<div class="event-card">
<% if EventParticipant.exists?(user_id: current_user.id, event_id: event.id) %>
    <%# front of the card %>
<% if event.event_image.end_with?("jpg") %>
      <div class="cover" style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0)40%, rgba(0, 0, 0, 0.9)80%), url(<%= image_url(event.event_image) %>)">
      <% else %>
      <div class="cover" style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0)40%, rgba(0, 0, 0, 0.9)80%), url(<%= image_url eval(event.event_image)["secure_url"] %>)">
      <%end%>
        <h1 class="card-address"><i class="fa">&#xf041;</i>
          <% if event.address.present? %>
            <% first_line_of_address = event.address.split(',')[0].strip if event.address %>
            <%= first_line_of_address %>
          <% else %>
            Address not available
          <% end %>
        </h1>
        <h1 class="event-card-title">
          <%= event.name %>
        </h1>
        <h2 class="card-time-date">
          <% date = event.date %>
          <% time = event.time %>
          <%= Time.parse(date.strftime("%Y-%m-%d")).strftime("%d/%m/%y") %>,
          <%= Time.parse(time.strftime("%I:%M%P")).strftime("%I:%M%P") %>
        </h2>
        <%# back of the card %>
        <div class="card-back">
            <div class="event-card-host">
              <%if event.group.user.avatar.nil? %>
                  <%= image_tag "blank_avatar.jpg", class: "avatar" %>
              <%else%>
                  <%= image_tag event.group.user.avatar, class: "avatar" %>
              <%end%>
              Hosted by <strong> <%= event.group.user.name%> </strong>
            </div>
          <br>
            <h3 class="event-card-title-back"><%= event.name %></h3>
          <br>
            <div class="event-card-description-box">
                <p class="event-card-description">
                  <%= event.description %>
                </p>
            </div>
            <div class="event-card-participants">
              <p><%= event.event_participants.count%> Squad members</p>
            </div>
            <a class="card-join-button" href="<%= group_event_path(event.group_id, event.id) %>">more details</a>
            <a class="card-join-button" href="<%= group_event_path(event.group_id, event.id) %>">Joined</a>
            </div>
          </div>
        </div>

<% else %>
  <%# This is the join event button form  %>
    <%= form_for [event, event, @event_participant] do |f| %>
    <%= f.hidden_field :user_id, value: current_user.id, class: 'card-join-hidden' %>
    <%= f.hidden_field :event_id, value: event.id, class: 'card-join-hidden' %>


    <%# front of the card %>
<% if event.event_image.end_with?("jpg") %>
      <div class="cover" style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0)40%, rgba(0, 0, 0, 0.9)80%), url(<%= image_url(event.event_image) %>)">
      <% else %>
      <div class="cover" style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0)40%, rgba(0, 0, 0, 0.9)80%), url(<%= image_url eval(event.event_image)["secure_url"] %>)">
      <%end%>
        <h1 class="card-address"><i class="fa">&#xf041;</i>
          <% if event.address.present? %>
            <% first_line_of_address = event.address.split(',')[0].strip if event.address %>
            <%= first_line_of_address %>
          <% else %>
            Address not available
          <% end %>
        </h1>
        <h1 class="event-card-title">
          <%= event.name %>
        </h1>
        <h2 class="card-time-date">
          <% date = event.date %>
          <% time = event.time %>
          <%= Time.parse(date.strftime("%Y-%m-%d")).strftime("%d/%m/%y") %>,
          <%= Time.parse(time.strftime("%I:%M%P")).strftime("%I:%M%P") %>
        </h2>
        <%# back of the card %>
        <div class="card-back">
            <div class="event-card-host">
              <%if event.group.user.avatar.nil? %>
                  <%= image_tag "blank_avatar.jpg", class: "avatar" %>
              <%else%>
                  <%= image_tag event.group.user.avatar, class: "avatar" %>
              <%end%>
              Hosted by <strong> <%= event.group.user.name%> </strong>
            </div>
          <br>
            <h3 class="event-card-title-back"><%= event.name %></h3>
          <br>
            <div class="event-card-description-box">
                <p class="event-card-description">
                  <%= event.description  %>
                </p>
            </div>
            <div class="event-card-participants">
              <p><%= event.event_participants.count%> Squad members</p>
            </div>
            <a class="card-join-button" href="<%= group_event_path(event.group_id, event.id) %>">more details</a>
<button type="submit" class="card-join-button" >
                <i class="fas fa-user-plus"></i>
            </button>
            </div>
          </div>
        </div>
      <% end %>
<% end %>


